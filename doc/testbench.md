**关于仿真环境的一些宏**
================================

仿真环境的宏都定义在testbench/include/common.h中

**DIFFTEST相关**
----------------------------------

1. DIFFTEST 宏用于控制是否开启difftest，注释掉即可关闭。
2. MTRACE 宏用于控制memory trace，注释掉即可关闭，该trace用于跟踪CPU的访存行为。
3. DIFFTEST_TRACE 宏用于控制是否输出实时difftest比对的pc，用于查看当前仿真中difftest是否起作用以及比对到了哪个指令地址，也是一种另类的instruction trace，注释掉即可关闭。
4. INTER_MEM 宏用于控制是否使用仿真主函数eval（）进行指令以及数据的读写，默认注释，此时使用DPI-C机制进行CPU与仿真环境的数据交互，如果要开启这个功能的话需要修改核对外的接口，具体的接口需要查看**void CpuTestBench :: eval()**中对dut的数据传输接口，同时在**Top.v**中也注释了相关的接口，改用**Mem.v**中定义的访存模块进行数据与指令的读写。

**另外一些宏**
---------------------------------------------
1. RESET_VECTOR 宏是CPU复位PC地址。
2. PMEM_SIZE 宏是存储空间大小。

**如何搭建仿真环境**
------------------------------------------
仿真环境搭建主要有以下步骤：
1. 选择搭建verilator下仿真环境框架的语言，可以选择c也可以选择c++，c++可以使用一些面向对象的方式能够更加便捷、直观地构建框架。
2. 构建生成仿真激励的模块，这里的激励指的是时钟以及复位。
3. 构建访存模型，这里的访存模型指的是CPU发出访存请求时对其进行响应的模块，在实际的硬件上应该是ram或者rom，但是由于这里是仿真环境，所以可以使用c语言的数组来模拟；同时要提供读写数组的函数。
4. 编写测试用例，这里建议使用高级语言编写，再通过交叉编译器生成二进制文件的方式来生成测试用例，不推荐使用汇编编写。
5. 编写测试脚本，实现一键编译与仿真。


有以下建议：
1. 建议分模块搭建，比如仿真激励、访存模型、difftest框架、比对框架都分模块构建。
2. difftest框架是一个在实现基本流水线之后值得花时间去搭建的测试工具，其好处在于能够在CPU出错的时候立即抛出error。
3. 应当尽量模块化地实现各个功能，这样便于后期修改。
4. 建议在实现一条指令之后立马进行该指令的测试，整数指令功能大多都比较单一，涉及的部件都比较少，因此只要能够通过一次difftest的比对，后面一般都不会出问题。
5. 有能力的话尽量使用脚本语言管理整个项目，包括编译与仿真。

